# Deployment Guide

## Prerequisites
- AWS Account with appropriate permissions
- GitHub Account
- Terraform installed (for infrastructure)

## Infrastructure Deployment

### Initial Setup
```bash
cd infrastructure
terraform init
terraform plan
terraform apply
```

This creates:
- S3 bucket for frontend hosting
- DynamoDB Expenses table
- Lambda function with IAM role
- Cognito User Pool (if configured)

### Frontend Deployment

#### Manual Deployment
```bash
cd frontend
npm run build
aws s3 sync build/ s3://your-bucket-name --delete
```

#### Automated Deployment (CI/CD)
- Push to main branch triggers automatic deployment  
- Frontend builds and deploys to S3 automatically  
- Configured via `.github/workflows/deploy-frontend.yml`  

### Backend Deployment

#### Manual Deployment
```bash
cd backend
pip install -r requirements.txt -t .
zip -r lambda.zip .
aws lambda update-function-code --function-name ExpensesHandler --zip-file fileb://lambda.zip
```

#### Automated Deployment (CI/CD)
- Push to main branch triggers automatic deployment  
- Lambda function updated automatically  
- Configured via `.github/workflows/deploy-backend.yml`  

### Environment Variables

#### Frontend (.env)
```env
REACT_APP_COGNITO_USER_POOL_ID=us-east-1_xxx
REACT_APP_COGNITO_CLIENT_ID=xxx
REACT_APP_API_GATEWAY_URL=https://xxx.execute-api.ca-central-1.amazonaws.com
```

#### Backend (Lambda Environment)
```env
EXPENSES_TABLE=Expenses
```

#### GitHub Secrets Required
- `AWS_ACCESS_KEY_ID`  
- `AWS_SECRET_ACCESS_KEY`  

### Troubleshooting

**Common Issues**  
- **CORS errors**: Check API Gateway CORS configuration  
- **Authentication failures**: Verify Cognito configuration  
- **Database access denied**: Check Lambda IAM role permissions  
- **Build failures**: Check CI/CD workflow logs  

### Rollback Procedures
- **Frontend**: Redeploy previous build from S3 versioning  
- **Backend**: Redeploy previous Lambda version  
- **Infrastructure**: Use `terraform destroy` and recreate  

---

# API Documentation

## Base URL
```
https://your-api-gateway-url.execute-api.ca-central-1.amazonaws.com
```

## Authentication
All endpoints require JWT token in Authorization header:

```
Authorization: Bearer <cognito_jwt_token>
```

## Endpoints

### Get All Expenses
```http
GET /expenses
```
**Response:**
```json
[
  {
    "expenseId": "uuid",
    "userId": "cognito_sub",
    "title": "Groceries",
    "amount": 75.50,
    "date": "2024-01-15",
    "category": "Food & Dining",
    "description": "Weekly grocery shopping"
  }
]
```

### Create Expense
```http
POST /expenses
```
**Body:**
```json
{
  "title": "Dinner",
  "amount": 45.00,
  "date": "2024-01-15",
  "category": "Food & Dining",
  "description": "Restaurant dinner with friends"
}
```

### Get Single Expense
```http
GET /expenses/{expenseId}
```

### Update Expense
```http
PUT /expenses/{expenseId}
```
**Body:** Same as create

### Delete Expense
```http
DELETE /expenses/{expenseId}
```

### Error Responses
**400 - Bad Request**
```json
{
  "message": "Invalid input data"
}
```

**401 - Unauthorized**
```json
{
  "message": "Unauthorized - Invalid token"
}
```

**404 - Not Found**
```json
{
  "message": "Expense not found"
}
```

**500 - Internal Server Error**
```json
{
  "message": "Internal server error"
}
```

### Data Types
**Expense Object**
| Field       | Type   | Description                          |
|-------------|--------|--------------------------------------|
| expenseId   | string | UUID generated by system             |
| userId      | string | Cognito user ID (auto-populated)     |
| title       | string | Expense description                  |
| amount      | number | Expense amount                       |
| date        | string | ISO date (YYYY-MM-DD)                |
| category    | string | Expense category                     |
| description | string | Optional detailed description        |

---

# Setup Guide

## Local Development

### Frontend Setup
```bash
cd frontend
npm install
npm start
```
App runs on `http://localhost:3000`

### Backend Development
```bash
cd backend
# Test Lambda function locally with mock events
```

## Production Deployment

### First-Time Setup
- **Infrastructure**: Run `terraform apply` in infrastructure folder  
- **Frontend**: Update `.env` with actual AWS resource IDs  
- **Backend**: Deploy Lambda function manually once  
- **CI/CD**: Set up GitHub Secrets in each repository  

### Repository Structure
```
expense-tracker-frontend/     # React application
expense-tracker-backend/      # Lambda functions
expense-tracker-docs/         # This documentation
infrastructure/               # Terraform configurations
```

### Required AWS Services
- S3 (Frontend hosting)  
- Lambda (Backend logic)  
- API Gateway (REST API)  
- DynamoDB (Database)  
- Cognito (Authentication)  
- IAM (Permissions)  

### Cost Estimation
- **Free Tier**: Most services covered under AWS Free Tier  
- **Production**: ~$5-10/month for low usage  
- **Monitoring**: CloudWatch included in minimal usage  

## Testing

### Frontend Tests
```bash
cd frontend
npm test
```

### API Testing
Use Postman or `curl` with valid JWT tokens  

### Monitoring
- CloudWatch logs for Lambda functions  
- S3 access logs (if enabled)  
- API Gateway metrics  
